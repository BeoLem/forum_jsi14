<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= page.title %></title>
    <%- include('../partials/components.ejs') %>
  </head>
  <body>
    <div class="interaction">
      <%- include('../partials/sidebar.ejs') %>
      <div id="content">
        <div class="w-100" id="btn-container">
          <button
            class="submit-btn create-btn"
            onclick="location.href = '/blogs/create'"
          >
            <span><i class="fa-regular fa-calendar-plus"></i></span>
            <span>Create a blog</span>
          </button>
        </div>

        <div class="blogs"></div>
      </div>
    </div>
  </body>
  <script type="text/javascript">
    function renderMoreBlog(array) {
      array.map((v) => {
        const postedDate = new Date(0);
        postedDate.setUTCSeconds(v.timestamp.seconds);

        document.querySelector(
          ".blogs"
        ).innerHTML += `<div class="blog" onclick="location.href = '/blogs/${
          v.id
        }'">
            <div class="header">
              <span
                >Posted by
                <a class="username" href="/users/${v.author}">blam</a>
              </span>
              <span
                class="timestamp"
                data-bs-toggle="tooltip"
                data-bs-placement="top"
                title="${postedDate}"
                >${ElapsedTimeConverter(postedDate)}</span
              >
            </div>

            <div class="main">
              <h3 class="title">${v.title}</h3>
            </div>
          </div>`;
      });
    }
    document.addEventListener("DOMContentLoaded", () => {
      jQuery(document).ready(async function ($) {
        showLoadingIcon();

        try {
          blogsFetchData = await $.ajax({
            url: `/api/blogs/@list?range=1-10`,
            method: "GET",
            accepts: "application/json",
            contentType: "application/json",
          });
        } catch (err) {
          console.log(err);
          document.querySelector("#content").style.display = "none";
          hideLoadingIcon();
          if (!err.responseJSON)
            return displayErrorToast("I couldn't connect to the server!");
          return displayErrorToast(err.responseJSON.message);
        }

        const blogs = blogsFetchData.data;

        renderMoreBlog(blogs);

        hideLoadingIcon();
      });
    });
  </script>
</html>

<style>
  .create-btn {
    margin-bottom: 50px;
    width: 100%;
    margin-top: 20px;
    height: 38px;
    border-radius: 50px;
  }

  .blog {
    border: 1px solid #d3d3d3;
    border-radius: 8px;
    padding: 10px;
    cursor: pointer;
    margin-bottom: 20px;
  }

  .blog:hover {
    opacity: 0.7;
  }

  .blog .header {
    margin-bottom: 20px;
  }

  .blog .header a {
    text-decoration: none;
  }

  .blog .header a:hover {
    text-decoration: underline;
  }

  .blog .main .title {
    font-weight: bold;
  }
</style>
